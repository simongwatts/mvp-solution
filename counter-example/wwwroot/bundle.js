(()=>{"use strict";const e={IncrementRequestedEvent:["ViewEvent"],CounterUpdatedEvent:["ModelEvent"]};class t{}class n{}class s extends n{}class o extends t{constructor(e){console.log("constructor CounterUpdatedEvent"),super(),this.newCount=e}}class c{constructor(e,t,n){this.view=e,this.model=t,this.eventBus=n,this.subscriptions=[],console.log("constructor PresenterBase"),this.initialize()}initialize(){console.log("Subscribe to concrete base events"),this.subscribe(n,(e=>this.onViewEvent(e))),this.subscribe(t,(e=>this.onModelEvent(e)))}onViewEvent(e){}onModelEvent(e){}subscribe(e,t){this.subscriptions.push(this.eventBus.subscribe(e,t))}dispose(){this.subscriptions.forEach((e=>e())),this.subscriptions=[]}}const i=new class{constructor(){this.subscriptions=new Map}publish(e){console.log("EventAggregator publish"),this.getEventTypeHierarchy(e).forEach((t=>{(this.subscriptions.get(t)||new Set).forEach((t=>t(e)))}))}subscribe(e,t){console.log("EventAggregator subscribe");const n=e.name,s=this.subscriptions.get(n)||new Set;return s.add(t),this.subscriptions.set(n,s),()=>this.unsubscribe(n,t)}unsubscribe(e,t){console.log("EventAggregator unsubscribe");const n=this.subscriptions.get(e);n&&(n.delete(t),0===n.size&&this.subscriptions.delete(e))}getEventTypeHierarchy(t){console.log("EventAggregator getEventTypeHierarchy");const n=[],s=t.constructor.name;return console.log("eventName: "+s),n.push(s),e[s]&&n.push(...e[s]),n}},r=new class{constructor(e){this.eventBus=e,console.log("constructor CounterView"),this.countElement=document.getElementById("count");const t=document.getElementById("increment-btn");if(!(t instanceof HTMLButtonElement))throw new Error("Increment button not found or is not a button element");this.incrementButton=t,this.incrementButton.textContent="Increment Me",this.incrementButton.addEventListener("click",(()=>{console.log("Increment button clicked"),this.eventBus.publish(new s)}))}updateCount(e){console.log("updateCount"),this.countElement.textContent=e.toString()}}(i),u=new class{constructor(e){this.eventBus=e,this.count=0}increment(){console.log("increment"),this.count++,this.eventBus.publish(new o(this.count))}}(i);new class extends c{constructor(e,t,n){console.log("constructor CounterPresenter"),super(e,t,n)}onViewEvent(e){console.log("onViewEvent"),e instanceof s&&(console.log("IncrementRequestedEvent"),this.model.increment())}onModelEvent(e){console.log("onModelEvent"),e instanceof o&&(console.log("CounterUpdatedEvent"),this.view.updateCount(e.newCount))}}(r,u,i)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGVBQ1pFLEtBQUtpQyxhQUFhTyxZQUFjRyxFQUFNQyxVQUMxQyxHRmpCeUJ4QyxHQUN2QkQsRUFBUSxJR05QLE1BQ0gsV0FBQVIsQ0FBWVMsR0FDUkosS0FBS0ksU0FBV0EsRUFDaEJKLEtBQUsyQyxNQUFRLENBQ2pCLENBQ0EsU0FBQUUsR0FDSWhELFFBQVFDLElBQUksYUFDWkUsS0FBSzJDLFFBQ0wzQyxLQUFLSSxTQUFTZSxRQUFRLElBQUl6QixFQUFvQk0sS0FBSzJDLE9BQ3ZELEdISDJCdkMsR0FDL0IsSUlMTyxjQUErQkgsRUFDbEMsV0FBQU4sQ0FBWU8sRUFBTUMsRUFBT0MsR0FDckJQLFFBQVFDLElBQUksZ0NBQ1pDLE1BQU1HLEVBQU1DLEVBQU9DLEVBQ3ZCLENBRUEsV0FBQUssQ0FBWUUsR0FDUmQsUUFBUUMsSUFBSSxlQUNSYSxhQUFpQmxCLElBQ2pCSSxRQUFRQyxJQUFJLDJCQUNaRSxLQUFLRyxNQUFNMEMsWUFFbkIsQ0FFQSxZQUFBbkMsQ0FBYUMsR0FDVGQsUUFBUUMsSUFBSSxnQkFDUmEsYUFBaUJqQixJQUNqQkcsUUFBUUMsSUFBSSx1QkFDWkUsS0FBS0UsS0FBS3dDLFlBQVkvQixFQUFNZixVQUVwQyxHSmZpQk0sRUFBTUMsRUFBT0MsRSIsInNvdXJjZXMiOlsid2VicGFjazovL2NvdW50ZXItZXhhbXBsZS8uLi9tdnAtY29yZS9zcmMvZXZlbnRzL0V2ZW50VHlwZXMudHMiLCJ3ZWJwYWNrOi8vY291bnRlci1leGFtcGxlLy4uL212cC1jb3JlL3NyYy9ldmVudHMvTW9kZWxFdmVudC50cyIsIndlYnBhY2s6Ly9jb3VudGVyLWV4YW1wbGUvLi4vbXZwLWNvcmUvc3JjL2V2ZW50cy9WaWV3RXZlbnQudHMiLCJ3ZWJwYWNrOi8vY291bnRlci1leGFtcGxlLy4vc3JjL2V2ZW50cy9Db3VudGVyRXZlbnRzLnRzIiwid2VicGFjazovL2NvdW50ZXItZXhhbXBsZS8uLi9tdnAtY29yZS9zcmMvcHJlc2VudGVycy9QcmVzZW50ZXJCYXNlLnRzIiwid2VicGFjazovL2NvdW50ZXItZXhhbXBsZS8uL3NyYy9hcHAudHMiLCJ3ZWJwYWNrOi8vY291bnRlci1leGFtcGxlLy4uL212cC1jb3JlL3NyYy9ldmVudHMvRXZlbnRBZ2dyZWdhdG9yLnRzIiwid2VicGFjazovL2NvdW50ZXItZXhhbXBsZS8uL3NyYy92aWV3cy9Db3VudGVyVmlldy50cyIsIndlYnBhY2s6Ly9jb3VudGVyLWV4YW1wbGUvLi9zcmMvbW9kZWxzL0NvdW50ZXJNb2RlbC50cyIsIndlYnBhY2s6Ly9jb3VudGVyLWV4YW1wbGUvLi9zcmMvcHJlc2VudGVycy9Db3VudGVyUHJlc2VudGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBldmVudEhpZXJhcmNoeSA9IHtcbiAgICAnSW5jcmVtZW50UmVxdWVzdGVkRXZlbnQnOiBbJ1ZpZXdFdmVudCddLFxuICAgICdDb3VudGVyVXBkYXRlZEV2ZW50JzogWydNb2RlbEV2ZW50J11cbn07XG4vLyBBZGQgbmV3IGV2ZW50cyBoZXJlIHJhdGhlciB0aGFuIG1vZGlmeWluZyBjb3JlIGNvZGVcbiIsIi8vIEJhc2UgY2xhc3MgZm9yIGFsbCBtb2RlbCBldmVudHNcbmV4cG9ydCBjbGFzcyBNb2RlbEV2ZW50IHtcbn1cbiIsIi8vIEJhc2UgY2xhc3MgZm9yIGFsbCB2aWV3IGV2ZW50c1xuZXhwb3J0IGNsYXNzIFZpZXdFdmVudCB7XG59XG4iLCJpbXBvcnQgeyBNb2RlbEV2ZW50IH0gZnJvbSBcIm12cC1jb3JlL2V2ZW50cy9Nb2RlbEV2ZW50XCI7XG5pbXBvcnQgeyBWaWV3RXZlbnQgfSBmcm9tIFwibXZwLWNvcmUvZXZlbnRzL1ZpZXdFdmVudFwiO1xuZXhwb3J0IGNsYXNzIEluY3JlbWVudFJlcXVlc3RlZEV2ZW50IGV4dGVuZHMgVmlld0V2ZW50IHtcbn1cbmV4cG9ydCBjbGFzcyBDb3VudGVyVXBkYXRlZEV2ZW50IGV4dGVuZHMgTW9kZWxFdmVudCB7XG4gICAgY29uc3RydWN0b3IobmV3Q291bnQpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjb25zdHJ1Y3RvciBDb3VudGVyVXBkYXRlZEV2ZW50XCIpO1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLm5ld0NvdW50ID0gbmV3Q291bnQ7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgTW9kZWxFdmVudCB9IGZyb20gXCIuLi9ldmVudHMvTW9kZWxFdmVudFwiO1xuaW1wb3J0IHsgVmlld0V2ZW50IH0gZnJvbSBcIi4uL2V2ZW50cy9WaWV3RXZlbnRcIjtcbmV4cG9ydCBjbGFzcyBQcmVzZW50ZXJCYXNlIHtcbiAgICBjb25zdHJ1Y3Rvcih2aWV3LCBtb2RlbCwgZXZlbnRCdXMpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gdmlldztcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgICAgICB0aGlzLmV2ZW50QnVzID0gZXZlbnRCdXM7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdO1xuICAgICAgICBjb25zb2xlLmxvZyhcImNvbnN0cnVjdG9yIFByZXNlbnRlckJhc2VcIik7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZSgpO1xuICAgIH1cbiAgICBpbml0aWFsaXplKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlN1YnNjcmliZSB0byBjb25jcmV0ZSBiYXNlIGV2ZW50c1wiKTtcbiAgICAgICAgdGhpcy5zdWJzY3JpYmUoVmlld0V2ZW50LCBlID0+IHRoaXMub25WaWV3RXZlbnQoZSkpO1xuICAgICAgICB0aGlzLnN1YnNjcmliZShNb2RlbEV2ZW50LCBlID0+IHRoaXMub25Nb2RlbEV2ZW50KGUpKTtcbiAgICB9XG4gICAgb25WaWV3RXZlbnQoZXZlbnQpIHsgfVxuICAgIG9uTW9kZWxFdmVudChldmVudCkgeyB9XG4gICAgc3Vic2NyaWJlKGV2ZW50VHlwZSwgaGFuZGxlcikge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLmV2ZW50QnVzLnN1YnNjcmliZShldmVudFR5cGUsIGhhbmRsZXIpKTtcbiAgICB9XG4gICAgZGlzcG9zZSgpIHtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmZvckVhY2godW5zdWJzY3JpYmUgPT4gdW5zdWJzY3JpYmUoKSk7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEV2ZW50QWdncmVnYXRvciB9IGZyb20gXCJtdnAtY29yZS9ldmVudHMvRXZlbnRBZ2dyZWdhdG9yXCI7XG5pbXBvcnQgeyBDb3VudGVyTW9kZWwgfSBmcm9tIFwiLi9tb2RlbHMvQ291bnRlck1vZGVsXCI7XG5pbXBvcnQgeyBDb3VudGVyVmlldyB9IGZyb20gXCIuL3ZpZXdzL0NvdW50ZXJWaWV3XCI7XG5pbXBvcnQgeyBDb3VudGVyUHJlc2VudGVyIH0gZnJvbSBcIi4vcHJlc2VudGVycy9Db3VudGVyUHJlc2VudGVyXCI7XG4vLyBJbml0aWFsaXplIGNvbXBvbmVudHNcbmNvbnN0IGV2ZW50QnVzID0gbmV3IEV2ZW50QWdncmVnYXRvcigpO1xuY29uc3QgdmlldyA9IG5ldyBDb3VudGVyVmlldyhldmVudEJ1cyk7XG5jb25zdCBtb2RlbCA9IG5ldyBDb3VudGVyTW9kZWwoZXZlbnRCdXMpO1xubmV3IENvdW50ZXJQcmVzZW50ZXIodmlldywgbW9kZWwsIGV2ZW50QnVzKTtcbiIsImltcG9ydCB7IGV2ZW50SGllcmFyY2h5IH0gZnJvbSBcIi4vRXZlbnRUeXBlc1wiO1xuZXhwb3J0IGNsYXNzIEV2ZW50QWdncmVnYXRvciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IG5ldyBNYXAoKTtcbiAgICB9XG4gICAgcHVibGlzaChldmVudCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkV2ZW50QWdncmVnYXRvciBwdWJsaXNoXCIpO1xuICAgICAgICBjb25zdCBldmVudFR5cGVzID0gdGhpcy5nZXRFdmVudFR5cGVIaWVyYXJjaHkoZXZlbnQpO1xuICAgICAgICBldmVudFR5cGVzLmZvckVhY2godHlwZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBoYW5kbGVycyA9IHRoaXMuc3Vic2NyaXB0aW9ucy5nZXQodHlwZSkgfHwgbmV3IFNldCgpO1xuICAgICAgICAgICAgaGFuZGxlcnMuZm9yRWFjaChoYW5kbGVyID0+IGhhbmRsZXIoZXZlbnQpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN1YnNjcmliZShldmVudFR5cGUsIGhhbmRsZXIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJFdmVudEFnZ3JlZ2F0b3Igc3Vic2NyaWJlXCIpO1xuICAgICAgICBjb25zdCB0eXBlTmFtZSA9IGV2ZW50VHlwZS5uYW1lO1xuICAgICAgICBjb25zdCBoYW5kbGVycyA9IHRoaXMuc3Vic2NyaXB0aW9ucy5nZXQodHlwZU5hbWUpIHx8IG5ldyBTZXQoKTtcbiAgICAgICAgaGFuZGxlcnMuYWRkKGhhbmRsZXIpO1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuc2V0KHR5cGVOYW1lLCBoYW5kbGVycyk7XG4gICAgICAgIHJldHVybiAoKSA9PiB0aGlzLnVuc3Vic2NyaWJlKHR5cGVOYW1lLCBoYW5kbGVyKTtcbiAgICB9XG4gICAgdW5zdWJzY3JpYmUodHlwZU5hbWUsIGhhbmRsZXIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJFdmVudEFnZ3JlZ2F0b3IgdW5zdWJzY3JpYmVcIik7XG4gICAgICAgIGNvbnN0IGhhbmRsZXJzID0gdGhpcy5zdWJzY3JpcHRpb25zLmdldCh0eXBlTmFtZSk7XG4gICAgICAgIGlmIChoYW5kbGVycykge1xuICAgICAgICAgICAgaGFuZGxlcnMuZGVsZXRlKGhhbmRsZXIpO1xuICAgICAgICAgICAgaWYgKGhhbmRsZXJzLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZGVsZXRlKHR5cGVOYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRFdmVudFR5cGVIaWVyYXJjaHkoZXZlbnQpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJFdmVudEFnZ3JlZ2F0b3IgZ2V0RXZlbnRUeXBlSGllcmFyY2h5XCIpO1xuICAgICAgICBjb25zdCB0eXBlcyA9IFtdO1xuICAgICAgICBjb25zdCBldmVudE5hbWUgPSBldmVudC5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgICAgICBjb25zb2xlLmxvZyhcImV2ZW50TmFtZTogXCIgKyBldmVudE5hbWUpO1xuICAgICAgICAvLyBBZGQgY29uY3JldGUgdHlwZVxuICAgICAgICB0eXBlcy5wdXNoKGV2ZW50TmFtZSk7XG4gICAgICAgIC8vIEFkZCByZWdpc3RlcmVkIGJhc2UgdHlwZXNcbiAgICAgICAgaWYgKGV2ZW50SGllcmFyY2h5W2V2ZW50TmFtZV0pIHtcbiAgICAgICAgICAgIHR5cGVzLnB1c2goLi4uZXZlbnRIaWVyYXJjaHlbZXZlbnROYW1lXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHR5cGVzO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEluY3JlbWVudFJlcXVlc3RlZEV2ZW50IH0gZnJvbSBcIi4uL2V2ZW50cy9Db3VudGVyRXZlbnRzXCI7XG5leHBvcnQgY2xhc3MgQ291bnRlclZpZXcge1xuICAgIGNvbnN0cnVjdG9yKGV2ZW50QnVzKSB7XG4gICAgICAgIHRoaXMuZXZlbnRCdXMgPSBldmVudEJ1cztcbiAgICAgICAgY29uc29sZS5sb2coXCJjb25zdHJ1Y3RvciBDb3VudGVyVmlld1wiKTtcbiAgICAgICAgdGhpcy5jb3VudEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY291bnQnKTtcbiAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luY3JlbWVudC1idG4nKTtcbiAgICAgICAgaWYgKGJ1dHRvbiBpbnN0YW5jZW9mIEhUTUxCdXR0b25FbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLmluY3JlbWVudEJ1dHRvbiA9IGJ1dHRvbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW5jcmVtZW50IGJ1dHRvbiBub3QgZm91bmQgb3IgaXMgbm90IGEgYnV0dG9uIGVsZW1lbnQnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluY3JlbWVudEJ1dHRvbi50ZXh0Q29udGVudCA9ICdJbmNyZW1lbnQgTWUnO1xuICAgICAgICB0aGlzLmluY3JlbWVudEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJbmNyZW1lbnQgYnV0dG9uIGNsaWNrZWQnKTtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMucHVibGlzaChuZXcgSW5jcmVtZW50UmVxdWVzdGVkRXZlbnQoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvL2RvY3VtZW50LmJvZHkuYXBwZW5kKHRoaXMuY291bnRFbGVtZW50LCB0aGlzLmluY3JlbWVudEJ1dHRvbik7XG4gICAgfVxuICAgIHVwZGF0ZUNvdW50KGNvdW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwidXBkYXRlQ291bnRcIik7XG4gICAgICAgIHRoaXMuY291bnRFbGVtZW50LnRleHRDb250ZW50ID0gY291bnQudG9TdHJpbmcoKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBDb3VudGVyVXBkYXRlZEV2ZW50IH0gZnJvbSBcIi4uL2V2ZW50cy9Db3VudGVyRXZlbnRzXCI7XG5leHBvcnQgY2xhc3MgQ291bnRlck1vZGVsIHtcbiAgICBjb25zdHJ1Y3RvcihldmVudEJ1cykge1xuICAgICAgICB0aGlzLmV2ZW50QnVzID0gZXZlbnRCdXM7XG4gICAgICAgIHRoaXMuY291bnQgPSAwO1xuICAgIH1cbiAgICBpbmNyZW1lbnQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiaW5jcmVtZW50XCIpO1xuICAgICAgICB0aGlzLmNvdW50Kys7XG4gICAgICAgIHRoaXMuZXZlbnRCdXMucHVibGlzaChuZXcgQ291bnRlclVwZGF0ZWRFdmVudCh0aGlzLmNvdW50KSk7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgUHJlc2VudGVyQmFzZSB9IGZyb20gXCJtdnAtY29yZS9wcmVzZW50ZXJzL1ByZXNlbnRlckJhc2VcIjtcbmltcG9ydCB7IENvdW50ZXJVcGRhdGVkRXZlbnQgfSBmcm9tIFwiLi4vZXZlbnRzL0NvdW50ZXJFdmVudHNcIjtcbmltcG9ydCB7IEluY3JlbWVudFJlcXVlc3RlZEV2ZW50IH0gZnJvbSBcIi4uL2V2ZW50cy9Db3VudGVyRXZlbnRzXCI7XG5leHBvcnQgY2xhc3MgQ291bnRlclByZXNlbnRlciBleHRlbmRzIFByZXNlbnRlckJhc2Uge1xuICAgIGNvbnN0cnVjdG9yKHZpZXcsIG1vZGVsLCBldmVudEJ1cykge1xuICAgICAgICBjb25zb2xlLmxvZyhcImNvbnN0cnVjdG9yIENvdW50ZXJQcmVzZW50ZXJcIik7XG4gICAgICAgIHN1cGVyKHZpZXcsIG1vZGVsLCBldmVudEJ1cyk7XG4gICAgfVxuICAgIC8vIEhhbmRsZSB2aWV3IGV2ZW50c1xuICAgIG9uVmlld0V2ZW50KGV2ZW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwib25WaWV3RXZlbnRcIik7XG4gICAgICAgIGlmIChldmVudCBpbnN0YW5jZW9mIEluY3JlbWVudFJlcXVlc3RlZEV2ZW50KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkluY3JlbWVudFJlcXVlc3RlZEV2ZW50XCIpO1xuICAgICAgICAgICAgdGhpcy5tb2RlbC5pbmNyZW1lbnQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBIYW5kbGUgbW9kZWwgdXBkYXRlc1xuICAgIG9uTW9kZWxFdmVudChldmVudCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIm9uTW9kZWxFdmVudFwiKTtcbiAgICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgQ291bnRlclVwZGF0ZWRFdmVudCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJDb3VudGVyVXBkYXRlZEV2ZW50XCIpO1xuICAgICAgICAgICAgdGhpcy52aWV3LnVwZGF0ZUNvdW50KGV2ZW50Lm5ld0NvdW50KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJldmVudEhpZXJhcmNoeSIsIk1vZGVsRXZlbnQiLCJWaWV3RXZlbnQiLCJJbmNyZW1lbnRSZXF1ZXN0ZWRFdmVudCIsIkNvdW50ZXJVcGRhdGVkRXZlbnQiLCJjb25zdHJ1Y3RvciIsIm5ld0NvdW50IiwiY29uc29sZSIsImxvZyIsInN1cGVyIiwidGhpcyIsIlByZXNlbnRlckJhc2UiLCJ2aWV3IiwibW9kZWwiLCJldmVudEJ1cyIsInN1YnNjcmlwdGlvbnMiLCJpbml0aWFsaXplIiwic3Vic2NyaWJlIiwiZSIsIm9uVmlld0V2ZW50Iiwib25Nb2RlbEV2ZW50IiwiZXZlbnQiLCJldmVudFR5cGUiLCJoYW5kbGVyIiwicHVzaCIsImRpc3Bvc2UiLCJmb3JFYWNoIiwidW5zdWJzY3JpYmUiLCJNYXAiLCJwdWJsaXNoIiwiZ2V0RXZlbnRUeXBlSGllcmFyY2h5IiwidHlwZSIsImdldCIsIlNldCIsInR5cGVOYW1lIiwibmFtZSIsImhhbmRsZXJzIiwiYWRkIiwic2V0IiwiZGVsZXRlIiwic2l6ZSIsInR5cGVzIiwiZXZlbnROYW1lIiwiY291bnRFbGVtZW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImJ1dHRvbiIsIkhUTUxCdXR0b25FbGVtZW50IiwiRXJyb3IiLCJpbmNyZW1lbnRCdXR0b24iLCJ0ZXh0Q29udGVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJ1cGRhdGVDb3VudCIsImNvdW50IiwidG9TdHJpbmciLCJpbmNyZW1lbnQiXSwic291cmNlUm9vdCI6IiJ9